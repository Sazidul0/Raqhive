# Raqhive_rules.yaml - Professional eBPF IDS/IPS Rules
 
 
rules:
  - name: "Suspicious Execution From Temp"
    description: "A process was executed from a temporary or world-writable directory."
    enabled: true
    event: "exec"
    severity: "medium"
    match:
      filename_regex: '^/(tmp|var/tmp|dev/shm)/.*'
 
  - name: "Web Server Spawning Shell"
    description: "A web server process spawned a shell, indicating a potential web shell."
    enabled: true
    event: "exec"
    severity: "high"
    match:
      parent_process_regex: '^(apache2|nginx|httpd|caddy)$'
      child_process_regex: '^(sh|bash|zsh|dash|ksh)$'
 
  - name: "Potential Data Exfiltration via Network"
    description: "A process accessed a sensitive file and then made an outbound connection within 5 minutes."
    enabled: true
    event: "connect"
    severity: "high"
    stateful:
      source_event_match:
        event: "open"
        filename_regex: '^/etc/(shadow|group|sudoers)$|^/root/\.ssh/id_rsa$'
      time_window_seconds: 300
 
  - name: "Low-Severity: Package Manager Execution"
    description: "Monitoring package manager activity."
    enabled: true
    event: "exec"
    severity: "low"
    match:
      filename_regex: '^/usr/bin/(apt|dpkg|yum|dnf|pacman|rpm|emerge)$'
 
  - name: "Unauthorized Binary Execution"
    description: "Execution of binaries outside common system paths (possible malware/persistence)."
    enabled: true
    event: "exec"
    severity: "medium"
    match:
      filename_regex: '^/(home|opt|srv|tmp|var/tmp)/.*\b(bin|sh|py|pl|rb|js|elf)\b'
 
  - name: "Suspicious Network Connection to Blacklisted IPs"
    description: "Outbound connection to known malicious or C2 IP addresses."
    enabled: true
    event: "connect"
    severity: "high"
    match:
      daddr_regex: '^(192\.168\.1\.100|10\.0\.0\.5|203\.0\.113\.50|185\.45\.66\.77|198\.51\.100\.123)$'
 
  - name: "Suspicious Child Process of SSH Daemon"
    description: "SSHD spawned interpreter or networking tool — common lateral movement sign."
    enabled: true
    event: "exec"
    severity: "high"
    match:
      parent_process_regex: '^sshd$'
      child_process_regex: '^(python|perl|ruby|nc|ncat|netcat|socat|bash|sh|zsh|dash|curl|wget)$'
 
  - name: "Unusual File Access"
    description: "Access to highly sensitive files (passwords, keys, logs)."
    enabled: true
    event: "open"
    severity: "medium"
    match:
      filename_regex: '^/(etc/(passwd|shadow|group|sudoers)|root/\.ssh/|var/log/(auth\.log|secure|lastlog))$'
 
  - name: "Script Execution via Temporary Files"
    description: "Execution of scripts directly from /tmp or /var/tmp."
    enabled: true
    event: "exec"
    severity: "medium"
    match:
      filename_regex: '^/(tmp|var/tmp|dev/shm)/.*\.(sh|py|pl|rb|js|php)$'
 
  - name: "High Volume Network Connections (Beaconing/C2)"
    description: "Process made many outbound connections in short time — possible beaconing."
    enabled: true
    event: "connect"
    severity: "high"
    stateful:
      source_event_match:
        event: "connect"
      time_window_seconds: 15
    match: {}
 
  - name: "New User Creation Attempt"
    description: "Execution of useradd/adduser — possible privilege escalation or persistence."
    enabled: true
    event: "exec"
    severity: "high"
    match:
      filename_regex: '^/(usr/sbin|sbin)/(useradd|adduser|vipw)$'
 
  - name: "Potential Reverse Shell Detection"
    description: "Shell/interpreter executed and immediately made outbound connection."
    enabled: true
    event: "connect"
    severity: "high"
    stateful:
      source_event_match:
        event: "exec"
        child_process_regex: '^(sh|bash|dash|zsh|nc|ncat|netcat|socat|python|perl|ruby|php|telnet)$'
      time_window_seconds: 30
 
  - name: "Unauthorized Mount Command Execution"
    description: "Non-root user executed mount command."
    enabled: true
    event: "exec"
    severity: "medium"
    match:
      filename_regex: '^/(bin|sbin|usr/bin|usr/sbin)/mount$'
      parent_process_regex: '^(?!root$).+'
 
  - name: "Sudo Command Usage"
    description: "Track all sudo executions (useful for audit)."
    enabled: true
    event: "exec"
    severity: "low"
    match:
      filename_regex: '^/usr/bin/sudo$'
 
  - name: "Cron Job Modification"
    description: "Direct modification of crontab files — persistence vector."
    enabled: true
    event: "open"
    severity: "high"
    match:
      filename_regex: '^/(var/spool/cron/crontabs/.*|etc/crontab|/etc/cron\.d/.*)$'
 
  - name: "SSH Key File Access"
    description: "Non-root access to SSH private keys."
    enabled: true
    event: "open"
    severity: "high"
    match:
      filename_regex: '^/root/\.ssh/id_rsa$|^/home/.*/\.ssh/id_rsa$'